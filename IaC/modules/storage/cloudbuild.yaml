steps:
  - name: 'hashicorp/terraform:1.6.6'
    args: ['init']
    dir: 'IaC/modules/storage'
    
  - name: 'hashicorp/terraform:1.6.6'
    args: ['apply', '-compact-warnings', '-auto-approve', '-var-file=../../environments/dev/main.tfvars']
    dir: 'IaC/modules/storage'

  # - name: 'gcr.io/cloud-builders/gcloud'
  #   entrypoint: 'bash'
  #   args:
  #     - '-c'
  #     - |
  #       export BUCKET_NAME=$(grep name_functions_bucket ../../environments/dev/main.tfvars | cut -d '=' -f2 | tr -d '[:space:]')

  - name: 'gcr.io/cloud-builders/gcloud'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        apt-get update && apt-get install -y zip
        zip -r qid_publisher.zip ./../../../Codigo/QID/qid_publisher
    dir: 'IaC/modules/storage'

  - name: 'gcr.io/cloud-builders/gcloud'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        apt-get update && apt-get install -y zip
        zip -r qae_publisher.zip ./../../../Codigo/QAE/qae_publisher
    dir: 'IaC/modules/storage'


  # - name: 'gcr.io/cloud-builders/gcloud'
  #   entrypoint: 'bash'
  #   args:
  #     - '-c'
  #     - 'zip -r qae_notification.zip ./../../../Codigo/QAE/qae_notification'
  #   dir: 'IaC/modules/storage'

  # - name: 'gcr.io/cloud-builders/gcloud'
  #   entrypoint: 'bash'
  #   args:
  #     - '-c'
  #     - 'zip -r yml_publisher.zip ./../../../Codigo/YML_Publisher/yml_publisher'
  #   dir: 'IaC/modules/storage'

  # - name: 'gcr.io/cloud-builders/gcloud'
  #   entrypoint: 'bash'
  #   args:
  #     - '-c'
  #     - 'zip -r config_gs.zip ./../../../Codigo/Config_GS/config_gs'
  #   dir: 'IaC/modules/storage'

  # - name: 'gcr.io/cloud-builders/gsutil'
  #   args: ['cp', 'qid_publisher.zip', 'gs://functions_dq_bucket/']
  #   dir: 'IaC/modules/storage'

  # - name: 'gcr.io/cloud-builders/gcloud'
  #   entrypoint: 'bash'
  #   args:
  #     - '-c'
  #     - 'gsutil cp qid_publisher.zip gs://functions_dq_bucket/'
  #   dir: 'IaC/modules/storage'

  - name: 'gcr.io/cloud-builders/gsutil'
    args: 
      - 'cp'
      - 'qid_publisher.zip'
      - 'qae_publisher.zip'
      # - 'qae_notification.zip'
      # - 'yml_publisher.zip'
      # - 'config_gs.zip'
      - 'gs://functions_dq_bucket/'
    dir: 'IaC/modules/storage'
